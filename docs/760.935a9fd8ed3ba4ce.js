"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[760],{760:(S,f,a)=>{a.r(f),a.d(f,{KeysPageModule:()=>_});var y=a(1368),k=a(2324),p=a(4716),h=a(9280),l=a(1528),g=a(4704),v=a(3889),C=a(5536),I=a(1220),b=a(1956),e=a(4496),o=a(2112);function R(s,n){if(1&s&&(e.I0R(0,"ion-item"),e.wR5(1,"img",12),e.C$Y()),2&s){const t=e.GaO(2);e.yG2(),e.E7m("src",t.imageData,e.K6U)}}function K(s,n){if(1&s&&(e.I0R(0,"div",9),e.yuY(1,R,2,1,"ion-item",10),e.I0R(2,"ion-item"),e.wR5(3,"ion-textarea",11),e.C$Y()()),2&s){const t=e.GaO();e.yG2(),e.E7m("ngIf",t.imageData),e.yG2(2),e.E7m("value",t.key)}}function w(s,n){if(1&s){const t=e.KQA();e.I0R(0,"ion-button",6),e.qCj("click",function(){e.usT(t);const c=e.GaO();return e.CGJ(c.shareQR())}),e.wR5(1,"ion-icon",13),e.I0R(2,"ion-label"),e.OEk(3,"Share QR Code"),e.C$Y()()}}class d{constructor(n,t,i){this.modalController=n,this.conversationService=t,this.toastController=i}ngOnInit(){var n=this;return(0,l.c)(function*(){let t=yield b.toDataURL([{data:n.key}],{errorCorrectionLevel:"H"}).catch(i=>(console.log(i),null));t?n.imageData=t:(yield n.toastController.create({message:"Error generating QR code.",duration:2e3})).present()})()}copy(){var n=this;return(0,l.c)(function*(){let t;yield navigator.clipboard.writeText(n.key).catch(i=>(console.log(i),t=i,null)),t||(yield n.toastController.create({message:"Public key copied to clipboard.",duration:2e3})).present()})()}shareQR(){var n=this;return(0,l.c)(function*(){navigator.share?navigator.share({files:[new File([C.Yz.base64ToBlob(n.imageData)],`encrypted-message-${Date.now()}.png`,{type:"image/png"})]}):window.open(n.imageData,"_blank")})()}dismiss(){this.modalController.dismiss()}static#e=this.\u0275fac=function(t){return new(t||d)(e.GI1(o.qS),e.GI1(I.eC),e.GI1(o.Gq))};static#t=this.\u0275cmp=e.In1({type:d,selectors:[["app-key-share"]],inputs:{key:"key"},decls:20,vars:2,consts:[["translucent","true"],["color","primary"],["slot","primary"],[3,"click"],["slot","icon-only","name","close"],["class","key",4,"ngIf"],["expand","block",3,"click"],["name","clipboard-outline","slot","start"],["expand","block",3,"click",4,"ngIf"],[1,"key"],[4,"ngIf"],["auto-grow","",3,"value"],[3,"src"],["name","qr-code-outline","slot","start"]],template:function(t,i){1&t&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e.OEk(3," Share Public Key "),e.C$Y(),e.I0R(4,"ion-buttons",2)(5,"ion-button",3),e.qCj("click",function(){return i.dismiss()}),e.wR5(6,"ion-icon",4),e.C$Y()()()(),e.I0R(7,"ion-content"),e.yuY(8,K,4,2,"div",5),e.C$Y(),e.I0R(9,"ion-footer")(10,"ion-toolbar")(11,"ion-grid")(12,"ion-row")(13,"ion-col")(14,"ion-button",6),e.qCj("click",function(){return i.copy()}),e.wR5(15,"ion-icon",7),e.I0R(16,"ion-label"),e.OEk(17,"Copy Text"),e.C$Y()()(),e.I0R(18,"ion-col"),e.yuY(19,w,4,0,"ion-button",8),e.C$Y()()()()()),2&t&&(e.yG2(8),e.E7m("ngIf",i.key),e.yG2(11),e.E7m("ngIf",i.imageData))},dependencies:[y.u_,o.sn,o.GS,o.Kk,o._i,o.eV,o.YP,o.wB,o.Ko,o.Yb,o.QR,o.qo,o.gP,o.tM,o.Md,o.qG]})}var G=a(1876);function Y(s,n){1&s&&e.wR5(0,"ion-icon",20)}function O(s,n){1&s&&e.wR5(0,"ion-icon",21)}function E(s,n){if(1&s){const t=e.KQA();e.I0R(0,"ion-button",16),e.qCj("click",function(){e.usT(t);const c=e.GaO().$implicit,r=e.GaO(3);return e.CGJ(r.unlockKey(c.id))}),e.wR5(1,"ion-icon",20),e.C$Y()}}function P(s,n){if(1&s){const t=e.KQA();e.I0R(0,"ion-item")(1,"div",10)(2,"div",11),e.yuY(3,Y,1,0,"ion-icon",12)(4,O,1,0,"ion-icon",13),e.OEk(5),e.C$Y(),e.I0R(6,"div",14),e.yuY(7,E,2,0,"ion-button",15),e.I0R(8,"ion-button",16),e.qCj("click",function(){const r=e.usT(t).$implicit,u=e.GaO(3);return e.CGJ(u.shareKey(r.publicKey))}),e.wR5(9,"ion-icon",17),e.C$Y(),e.I0R(10,"ion-button",18),e.qCj("click",function(){const r=e.usT(t).$implicit,u=e.GaO(3);return e.CGJ(u.deleteKey(r.id))}),e.wR5(11,"ion-icon",19),e.C$Y()()()()}if(2&s){const t=n.$implicit;e.yG2(3),e.E7m("ngIf",t.unlocked),e.yG2(),e.E7m("ngIf",!t.unlocked),e.yG2(),e.oRS(" ",t.name," "),e.yG2(2),e.E7m("ngIf",!t.unlocked)}}function $(s,n){if(1&s&&(e.I0R(0,"ion-list",8),e.yuY(1,P,12,4,"ion-item",9),e.C$Y()),2&s){const t=e.GaO().ngIf;e.yG2(),e.E7m("ngForOf",t)}}function T(s,n){1&s&&(e.I0R(0,"div",22)(1,"h2"),e.OEk(2,"No Keys"),e.C$Y(),e.I0R(3,"p"),e.OEk(4," Keys are used to encrypt and and decrypt messages. You can share any of your keys with any of your contacts. When a new key is added, two elements are created: "),e.C$Y(),e.I0R(5,"h3"),e.OEk(6,"Private Key"),e.C$Y(),e.I0R(7,"p"),e.OEk(8," A secret key that, as the name suggests, is never shared with anyone. Used to decrypt messages. For extra security, this can be protected with a password when a key is created. If a key is password protected, it will have to be unlocked before decrypting anything. Don't forget or lose the password, it is not recoverable. "),e.C$Y(),e.I0R(9,"h3"),e.OEk(10,"Public Key"),e.C$Y(),e.I0R(11,"p"),e.OEk(12," A key that is shared with anybody that needs to send you messages. This can be shared via plain text or QR code. "),e.C$Y()())}function x(s,n){if(1&s&&(e.I0R(0,"div",5),e.yuY(1,$,2,1,"ion-list",6)(2,T,13,0,"div",7),e.C$Y()),2&s){const t=n.ngIf;e.yG2(),e.E7m("ngIf",t.length),e.yG2(),e.E7m("ngIf",!t.length)}}class m{constructor(n,t,i,c){this.keyService=n,this.modalController=t,this.toastController=i,this.routerOutlet=c,this.keys$=this.keyService.keys$.pipe((0,g.k)(r=>r.sort((u,M)=>u.created-M.created)))}ngOnDestroy(){}generateKey(){var n=this;return(0,l.c)(function*(){yield(yield n.modalController.create({component:v._,canDismiss:!0,presentingElement:n.routerOutlet.nativeEl})).present()})()}unlockKey(n){var t=this;return(0,l.c)(function*(){const i=window.prompt("Enter the password for this key.");(yield t.keyService.unlockKey(n,i).catch(r=>(console.log(r),null)))||alert("Couldn't unlock key with the given password.")})()}showPublicKey(n){var t=this;return(0,l.c)(function*(){let i;yield navigator.clipboard.writeText(n).catch(c=>(console.log(c),i=c,null)),alert(n),i||(yield t.toastController.create({message:"Public key copied to clipboard.",duration:2e3})).present()})()}shareKey(n){var t=this;return(0,l.c)(function*(){yield(yield t.modalController.create({component:d,canDismiss:!0,presentingElement:t.routerOutlet.nativeEl,componentProps:{key:n}})).present()})()}deleteKey(n){var t=this;return(0,l.c)(function*(){window.confirm("Are you absolutely sure? This is unrecoverable without a backup.")&&t.keyService.removeKey(n)})()}static#e=this.\u0275fac=function(t){return new(t||m)(e.GI1(G.qk),e.GI1(o.qS),e.GI1(o.Gq),e.GI1(o.Cg))};static#t=this.\u0275cmp=e.In1({type:m,selectors:[["app-keys"]],decls:16,vars:3,consts:[["translucent","true"],["color","primary"],["class","keys",4,"ngIf"],["expand","block",3,"click"],["name","repeat-outline","slot","start"],[1,"keys"],["class","key-list",4,"ngIf"],["class","key-fallback",4,"ngIf"],[1,"key-list"],[4,"ngFor","ngForOf"],[1,"key"],[1,"key-name"],["name","lock-open-outline",4,"ngIf"],["name","lock-closed-outline",4,"ngIf"],[1,"buttons"],[3,"click",4,"ngIf"],[3,"click"],["name","share-outline"],["color","danger",3,"click"],["name","trash-outline"],["name","lock-open-outline"],["name","lock-closed-outline"],[1,"key-fallback"]],template:function(t,i){1&t&&(e.I0R(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e.OEk(3," Encryption Keys "),e.C$Y()()(),e.I0R(4,"ion-content"),e.yuY(5,x,3,2,"div",2),e.wVc(6,"async"),e.C$Y(),e.I0R(7,"ion-footer")(8,"ion-toolbar")(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"ion-button",3),e.qCj("click",function(){return i.generateKey()}),e.wR5(13,"ion-icon",4),e.I0R(14,"ion-label"),e.OEk(15,"Generate New Key"),e.C$Y()()()()()()()),2&t&&(e.yG2(5),e.E7m("ngIf",e.kDX(6,1,i.keys$)))},dependencies:[y.ay,y.u_,o.sn,o.Kk,o._i,o.eV,o.YP,o.wB,o.Ko,o.Yb,o.QR,o.OC,o.qo,o.tM,o.Md,y.a],styles:[".keys[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:center}.keys[_ngcontent-%COMP%]   .key-list[_ngcontent-%COMP%]{width:100%}.keys[_ngcontent-%COMP%]   .key-list[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.keys[_ngcontent-%COMP%]   .key-fallback[_ngcontent-%COMP%]{margin:10px;max-width:400px}"]})}class _{static#e=this.\u0275fac=function(t){return new(t||_)};static#t=this.\u0275mod=e.a4G({type:_});static#n=this.\u0275inj=e.s3X({imports:[y.MD,k.qQ.forChild([{path:"",component:m}]),p.sl,h.k]})}}}]);