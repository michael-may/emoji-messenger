"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4515],{4515:(J,_,r)=>{r.r(_),r.d(_,{KeysPageModule:()=>l});var u=r(9808),p=r(4030),Z=r(4182),h=r(4466),a=r(655),f=r(4850),v=r(5340),k=r(3988),T=r(9278),b=r(3259),e=r(9863),n=r(5362);function A(i,o){if(1&i&&(e.TgZ(0,"ion-item"),e._UZ(1,"img",12),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("src",t.imageData,e.LSH)}}function x(i,o){if(1&i&&(e.TgZ(0,"div",9),e.YNc(1,A,2,1,"ion-item",10),e.TgZ(2,"ion-item"),e._UZ(3,"ion-textarea",11),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.imageData),e.xp6(2),e.Q6J("value",t.key)}}function K(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",6),e.NdJ("click",function(){return e.CHM(t),e.oxw().shareQR()}),e._UZ(1,"ion-icon",13),e.TgZ(2,"ion-label"),e._uU(3,"Share QR Code"),e.qZA(),e.qZA()}}class g{constructor(o,t,s){this.modalController=o,this.conversationService=t,this.toastController=s}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){let o=yield b.toDataURL([{data:this.key}],{errorCorrectionLevel:"H"}).catch(t=>(console.log(t),null));o?this.imageData=o:(yield this.toastController.create({message:"Error generating QR code.",duration:2e3})).present()})}copy(){return(0,a.mG)(this,void 0,void 0,function*(){let o;yield navigator.clipboard.writeText(this.key).catch(t=>(console.log(t),o=t,null)),o||(yield this.toastController.create({message:"Public key copied to clipboard.",duration:2e3})).present()})}shareQR(){return(0,a.mG)(this,void 0,void 0,function*(){navigator.share?navigator.share({files:[new File([k.Pp.base64ToBlob(this.imageData)],`encrypted-message-${Date.now()}.png`,{type:"image/png"})]}):window.open(this.imageData,"_blank")})}dismiss(){this.modalController.dismiss()}}g.\u0275fac=function(o){return new(o||g)(e.Y36(n.IN),e.Y36(T.EA),e.Y36(n.yF))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-key-share"]],inputs:{key:"key"},decls:20,vars:2,consts:[["translucent","true"],["color","primary"],["slot","primary"],[3,"click"],["slot","icon-only","name","close"],["class","key",4,"ngIf"],["expand","block",3,"click"],["name","clipboard-outline","slot","start"],["expand","block",3,"click",4,"ngIf"],[1,"key"],[4,"ngIf"],["auto-grow","",3,"value"],[3,"src"],["name","qr-code-outline","slot","start"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-title"),e._uU(3," Share Public Key "),e.qZA(),e.TgZ(4,"ion-buttons",2),e.TgZ(5,"ion-button",3),e.NdJ("click",function(){return t.dismiss()}),e._UZ(6,"ion-icon",4),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"ion-content"),e.YNc(8,x,4,2,"div",5),e.qZA(),e.TgZ(9,"ion-footer"),e.TgZ(10,"ion-toolbar"),e.TgZ(11,"ion-grid"),e.TgZ(12,"ion-row"),e.TgZ(13,"ion-col"),e.TgZ(14,"ion-button",6),e.NdJ("click",function(){return t.copy()}),e._UZ(15,"ion-icon",7),e.TgZ(16,"ion-label"),e._uU(17,"Copy Text"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"ion-col"),e.YNc(19,K,4,0,"ion-button",8),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(8),e.Q6J("ngIf",t.key),e.xp6(11),e.Q6J("ngIf",t.imageData))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.YG,n.gu,n.W2,u.O5,n.fr,n.jY,n.Nd,n.wI,n.Q$,n.Ie,n.g2,n.j9],styles:[""]});var U=r(8115);function w(i,o){1&i&&e._UZ(0,"ion-icon",19)}function q(i,o){1&i&&e._UZ(0,"ion-icon",20)}function C(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",15),e.NdJ("click",function(){e.CHM(t);const c=e.oxw().$implicit;return e.oxw(2).unlockKey(c.id)}),e._UZ(1,"ion-icon",19),e.qZA()}}function P(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item"),e.TgZ(1,"div",9),e.TgZ(2,"div",10),e.YNc(3,w,1,0,"ion-icon",11),e.YNc(4,q,1,0,"ion-icon",12),e._uU(5),e.qZA(),e.TgZ(6,"div",13),e.YNc(7,C,2,0,"ion-button",14),e.TgZ(8,"ion-button",15),e.NdJ("click",function(){const d=e.CHM(t).$implicit;return e.oxw(2).shareKey(d.publicKey)}),e._UZ(9,"ion-icon",16),e.qZA(),e.TgZ(10,"ion-button",17),e.NdJ("click",function(){const d=e.CHM(t).$implicit;return e.oxw(2).deleteKey(d.id)}),e._UZ(11,"ion-icon",18),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=o.$implicit;e.xp6(3),e.Q6J("ngIf",t.unlocked),e.xp6(1),e.Q6J("ngIf",!t.unlocked),e.xp6(1),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("ngIf",!t.unlocked)}}function I(i,o){1&i&&(e.TgZ(0,"div",21),e.TgZ(1,"h2"),e._uU(2,"No Keys"),e.qZA(),e.TgZ(3,"p"),e._uU(4," Keys are used to encrypt and and decrypt messages. "),e._UZ(5,"br"),e._uU(6," When a new key is added, two elements are created: "),e.qZA(),e.TgZ(7,"h3"),e._uU(8,"Private Key"),e.qZA(),e.TgZ(9,"p"),e._uU(10," A secret key that, as the name suggests, is never shared with anyone. Used to decrypt messages. "),e._UZ(11,"br"),e._uU(12," For extra security, this can be protected with a password when a key is created. "),e._UZ(13,"br"),e._uU(14," If a key is password protected, it will have to be unlocked before decrypting anything. "),e._UZ(15,"br"),e._uU(16," Don't forget or lose the password, it is not recoverable. "),e.qZA(),e.TgZ(17,"h3"),e._uU(18,"Public Key"),e.qZA(),e.TgZ(19,"p"),e._uU(20," A key that is shared with anybody that needs to send you messages. "),e._UZ(21,"br"),e._uU(22," This can be shared via plain text or QR code. "),e.qZA(),e.qZA())}function N(i,o){if(1&i&&(e.TgZ(0,"div",5),e.TgZ(1,"ion-list",6),e.YNc(2,P,12,4,"ion-item",7),e.qZA(),e.YNc(3,I,23,0,"div",8),e.qZA()),2&i){const t=o.ngIf;e.xp6(2),e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("ngIf",!t.length)}}class y{constructor(o,t,s,c){this.keyService=o,this.modalController=t,this.toastController=s,this.routerOutlet=c,this.keys$=this.keyService.keys$.pipe((0,f.U)(d=>d.sort((m,Y)=>m.created-Y.created)))}ngOnDestroy(){}generateKey(){return(0,a.mG)(this,void 0,void 0,function*(){yield(yield this.modalController.create({component:v.K,swipeToClose:!0,presentingElement:this.routerOutlet.nativeEl})).present()})}unlockKey(o){return(0,a.mG)(this,void 0,void 0,function*(){const t=window.prompt("Enter the password for this key.");(yield this.keyService.unlockKey(o,t).catch(c=>(console.log(c),null)))||alert("Couldn't unlock key with the given password.")})}showPublicKey(o){return(0,a.mG)(this,void 0,void 0,function*(){let t;yield navigator.clipboard.writeText(o).catch(s=>(console.log(s),t=s,null)),alert(o),t||(yield this.toastController.create({message:"Public key copied to clipboard.",duration:2e3})).present()})}shareKey(o){return(0,a.mG)(this,void 0,void 0,function*(){yield(yield this.modalController.create({component:g,swipeToClose:!0,presentingElement:this.routerOutlet.nativeEl,componentProps:{key:o}})).present()})}deleteKey(o){return(0,a.mG)(this,void 0,void 0,function*(){window.confirm("Are you absolutely sure? This is unrecoverable.")&&this.keyService.removeKey(o)})}}y.\u0275fac=function(o){return new(o||y)(e.Y36(U.BA),e.Y36(n.IN),e.Y36(n.yF),e.Y36(n.jP))},y.\u0275cmp=e.Xpm({type:y,selectors:[["app-keys"]],decls:16,vars:3,consts:[["translucent","true"],["color","primary"],["class","keys",4,"ngIf"],["expand","block",3,"click"],["name","repeat-outline","slot","start"],[1,"keys"],[1,"key-list"],[4,"ngFor","ngForOf"],["class","key-fallback",4,"ngIf"],[1,"key"],[1,"key-name"],["name","lock-open-outline",4,"ngIf"],["name","lock-closed-outline",4,"ngIf"],[1,"buttons"],[3,"click",4,"ngIf"],[3,"click"],["name","share-outline"],["color","danger",3,"click"],["name","trash-outline"],["name","lock-open-outline"],["name","lock-closed-outline"],[1,"key-fallback"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-title"),e._uU(3," Encryption Keys "),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"ion-content"),e.YNc(5,N,4,2,"div",2),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"ion-footer"),e.TgZ(8,"ion-toolbar"),e.TgZ(9,"ion-grid"),e.TgZ(10,"ion-row"),e.TgZ(11,"ion-col"),e.TgZ(12,"ion-button",3),e.NdJ("click",function(){return t.generateKey()}),e._UZ(13,"ion-icon",4),e.TgZ(14,"ion-label"),e._uU(15,"Generate New Key"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(5),e.Q6J("ngIf",e.lcZ(6,1,t.keys$)))},directives:[n.Gu,n.sr,n.wd,n.W2,u.O5,n.fr,n.jY,n.Nd,n.wI,n.YG,n.gu,n.Q$,n.q_,u.sg,n.Ie],pipes:[u.Ov],styles:[".key-list[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center}.key-fallback[_ngcontent-%COMP%]{margin:10px}"]});class l{}l.\u0275fac=function(o){return new(o||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[[u.ez,p.Bz.forChild([{path:"",component:y}]),Z.UX,h.m]]})}}]);